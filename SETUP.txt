# RNA-seq Course: 1-Minute Google Sheets Setup

This method is FASTER than Formspree and saves data directly into your Google Sheet.

---

### STEP 1: Prepare the Google Sheet
1. Open a new [Google Sheet](https://sheets.new/).
2. Name it "RNA-seq Registrations".
3. Click on **Extensions** -> **Apps Script**.

### STEP 2: Paste the Script
Delete everything in the script editor and paste this code:

```javascript
// Google Apps Script Code
function doPost(e) {
  try {
    var sheet = SpreadsheetApp.getActiveSpreadsheet().getActiveSheet();
    var data = e.parameter;
    
    var fileUrl = "No File Uploaded";
    
    // 1. Handle File Upload (Payment Proof)
    if (data.fileData && data.fileName) {
      try {
        var decoded = Utilities.base64Decode(data.fileData);
        var blob = Utilities.newBlob(decoded, data.mimeType, data.fileName);
        var file = DriveApp.createFile(blob);
        file.setSharing(DriveApp.Access.ANYONE_WITH_LINK, DriveApp.Permission.VIEW);
        fileUrl = file.getUrl();
      } catch (fError) {
        fileUrl = "Error saving file: " + fError.toString();
      }
    }
    
    // 2. Save Data to Sheet
    if (sheet.getLastRow() == 0) {
      // Initialize Header
      sheet.appendRow(["Timestamp", "Email", "Research Focus", "Proficiency", "OS", "Timing", "Group Size", "Transaction ID", "Comments", "Qualification", "Country", "Region", "City", "Payment Proof"]);
    }
    
    sheet.appendRow([
      new Date(), 
      data.email, 
      data.background || "-", 
      data.experience || "-", 
      data.os || "-", 
      data.timing || "-", 
      data['group-size'] || "1", 
      data.transaction_id || "PENDING", 
      data.comments || "-",
      data.qualification || "-",
      data.country || "-",
      data.region || "-",
      data.city || "-",
      fileUrl
    ]);
    
    // 3. Send Confirmation Email (Only on initial registration)
    if (data.email && !data.type) { 
      var subject = "Registration Received: RNA-seq Course";
      var body = "Hello,\n\nThank you for registering for the RNA-seq Analysis Course.\n\nWe have received your details safely.\n\nPLEASE COMPLETE PAYMENT to secure your spot.\n\nBest Regards,\nRNA-seq Course Team";
      
      MailApp.sendEmail({to: data.email, subject: subject, body: body});
    }

    return ContentService.createTextOutput("Success").setMimeType(ContentService.MimeType.TEXT);
    
  } catch (error) {
    return ContentService.createTextOutput("Error: " + error.toString()).setMimeType(ContentService.MimeType.TEXT);
  }
}

// --- PERMISSION HELPER ---
function authorizeEmail() {
  var email = Session.getActiveUser().getEmail();
  MailApp.sendEmail({
    to: email,
    subject: "Authorization Success",
    body: "Your RNA-seq registration emails (and Drive access) should now work!"
  });
  Logger.log("Test email sent to: " + email);
  // Also try to access Drive to trigger permission prompt
  var driveIterator = DriveApp.getFiles();
}
```

### STEP 2b: Authorize Email (Fix for missing notifications)
1.  Select **authorizeEmail** from the dropdown menu (next to the "Debug" button).
2.  Click **Run**.
3.  You will likely see a **"Review Permissions"** popup.
4.  Click **Review Permissions** -> Account -> **Advanced** -> **Go to ... (unsafe)** -> **Allow**.
5.  Check your inbox for the "Authorization Success" email.

### STEP 3: Deploy as Web App
1. Click the **Deploy** button (top right) -> **New deployment**.
2. Select type: **Web App**.
3. Description: "Form Submission".
4. Execute as: **Me** (your email).
5. Who has access: **Anyone** (This is required for the form to work).
6. Click **Deploy**.

> [!IMPORTANT]
> **If you see "Google hasn't verified this app":**
> 1. Click **Advanced**.
> 2. Click **Go to [Project Name] (unsafe)** at the bottom left.
> 3. Click **Allow**.
> *This is normal because the script is private and created by you.*

7. **COPY THE WEB APP URL.**

### STEP 4: Link to Website
- **DONE**: I have already updated `script.js` with your URL: `https://script.google.com/macros/s/AKfycbwj54jACeqNCASt7doCOrdX-fS-OTiVicZ2MHfBmG2392Fr2zwfydCwiRr041Lt5kLm/exec`

---

## ï¿½ Security: How to hide your UPI and Sheet URL
I have moved your sensitive info to **GitHub Secrets**. This keeps your code clean on GitHub while keeping your site working.

### STEP 5: Add Secrets to GitHub
1. Open your repository on GitHub.com.
2. Go to **Settings** (top tab) -> **Secrets and variables** (left menu) -> **Actions**.
3. Click the green button: **"New repository secret"**.
4. Add the first secret:
   - **Name**: `UPI_ID` (Uppercase, NO spaces, NO dots)
   - **Value**: `6006393231@upi`
5. Click **"Add secret"**.
6. Click **"New repository secret"** again for the second one:
   - **Name**: `GOOGLE_SHEET_URL` (Uppercase, NO spaces, uses underscores `_`)
   - **Value**: `https://script.google.com/macros/s/AKfycbwj54jACeqNCASt7doCOrdX-fS-OTiVicZ2MHfBmG2392Fr2zwfydCwiRr041Lt5kLm/exec`
7. Click **"Add secret"**.
